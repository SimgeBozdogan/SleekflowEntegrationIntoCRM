<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SleekFlow Inbox</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #f5f7fa;
      font-family: -apple-system, system-ui, "Segoe UI", Roboto, sans-serif;
    }
    
    #sleekflow-container {
      height: calc(100vh - 50px);
      width: 100%;
      border: none;
      border-radius: 0;
      overflow: hidden;
      position: relative;
    }
    
    /* Widget iframe stilleri */
    #sleekflow-container iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    
    .header {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: 600;
      font-size: 17px;
    }
    
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: calc(100% - 50px);
      color: #666;
    }
    
  </style>
</head>
<body>
  <div class="header">SleekFlow CanlÄ± Sohbet</div>
  <div id="sleekflow-container">
    <div style="padding: 20px; text-align: center; color: #666;">
      <p>Widget yÃ¼kleniyor...</p>
      <p style="font-size: 12px; margin-top: 10px;">EÄŸer widget gÃ¶rÃ¼nmÃ¼yorsa, tarayÄ±cÄ± konsolunu (F12) aÃ§Ä±p hatalarÄ± kontrol edin.</p>
    </div>
  </div>

  <!-- Start of SleekFlow Embed Code -->
  <script src="https://chat.sleekflow.io/embed_iframe.js" 
    data-id="travischatwidget"
    data-companyid="34ca3ad0-6bb3-426f-9b89-d40c8990b861"
    data-location="westeurope"
    type="text/javascript">
  </script>
  <!-- End of SleekFlow Embed Code -->
  
  <script>
    // Widget yÃ¼klenme kontrolÃ¼
    window.addEventListener('load', function() {
      console.log('âœ… Sayfa yÃ¼klendi, Sleekflow widget kontrol ediliyor...');
      
      // Widget'Ä±n yÃ¼klenmesini bekle
      setTimeout(function() {
        var widgetIframe = document.querySelector('iframe[src*="sleekflow"]');
        var allIframes = document.querySelectorAll('iframe');
        
        console.log('ğŸ” Iframe sayÄ±sÄ±:', allIframes.length);
        allIframes.forEach(function(iframe, index) {
          console.log(`   Iframe ${index}:`, iframe.src || 'no src');
        });
        
        if (widgetIframe) {
          console.log('âœ… Sleekflow widget iframe bulundu!');
          console.log('   Widget src:', widgetIframe.src);
          
          // Container'a taÅŸÄ±
          var container = document.getElementById('sleekflow-container');
          if (container) {
            // Container iÃ§indeki "yÃ¼kleniyor" mesajÄ±nÄ± temizle
            // Ã–NEMLÄ°: Iframe'i kaybetmemek iÃ§in Ã¶nce kaydet
            var iframeToMove = widgetIframe;
            container.innerHTML = '';
            
            // Iframe'i container'a ekle
            container.appendChild(iframeToMove);
            console.log('âœ… Widget container\'a eklendi (iÃ§erik temizlendi)');
            
            // Iframe stillerini ayarla
            widgetIframe.style.width = '100%';
            widgetIframe.style.height = 'calc(100vh - 50px)';
            widgetIframe.style.border = 'none';
            widgetIframe.style.display = 'block';
            widgetIframe.style.position = 'absolute';
            widgetIframe.style.top = '0';
            widgetIframe.style.left = '0';
            widgetIframe.style.zIndex = '1';
            
            // Container'Ä±n gÃ¶rÃ¼nÃ¼r olduÄŸundan emin ol
            container.style.position = 'relative';
            container.style.height = 'calc(100vh - 50px)';
            
            console.log('âœ… Widget stilleri ayarlandÄ±');
            console.log('   Iframe boyutlarÄ±:', widgetIframe.offsetWidth, 'x', widgetIframe.offsetHeight);
            console.log('   Container boyutlarÄ±:', container.offsetWidth, 'x', container.offsetHeight);
            
            // Widget'Ä±n yÃ¼klendiÄŸini kontrol et
            if (widgetIframe.contentWindow) {
              console.log('âœ… Widget iframe iÃ§eriÄŸi eriÅŸilebilir');
              try {
                // Iframe yÃ¼klendiÄŸinde bildirim al
                widgetIframe.onload = function() {
                  console.log('âœ… Widget iframe iÃ§eriÄŸi yÃ¼klendi!');
                };
              } catch(e) {
                console.warn('âš ï¸ Widget iframe iÃ§eriÄŸine eriÅŸim sÄ±nÄ±rlÄ± (cross-origin):', e.message);
              }
            }
            
            console.log('ğŸ‰ WIDGET BAÅARIYLA BAÄLANDI!');
          } else {
            console.error('âŒ Container bulunamadÄ±!');
          }
        } else {
          console.warn('âš ï¸ Sleekflow widget iframe bulunamadÄ±');
          console.warn('   Widget script yÃ¼klenmiÅŸ olabilir ama iframe oluÅŸmamÄ±ÅŸ');
          
          // Widget script'inin yÃ¼klenip yÃ¼klenmediÄŸini kontrol et
          var scripts = document.querySelectorAll('script[src*="sleekflow"]');
          console.log('ğŸ” Sleekflow script sayÄ±sÄ±:', scripts.length);
          
          if (scripts.length === 0) {
            console.error('âŒ Sleekflow widget script hiÃ§ yÃ¼klenmemiÅŸ!');
          } else {
            console.log('âœ… Sleekflow widget script yÃ¼klendi ama iframe oluÅŸmamÄ±ÅŸ');
          }
        }
      }, 5000); // 5 saniye bekle
    });
  </script>

  <!-- Zoho Embedded App API -->
  <script src="https://static.zoho.com/crm/js/api/v2/zoho.js"></script>
  
  <script>
    // Zoho Embedded App baÅŸlatma - ZOHO yÃ¼klendikten sonra Ã§alÄ±ÅŸacak
    function initZoho() {
      if (typeof ZOHO === 'undefined') {
        console.warn('âš ï¸ ZOHO henÃ¼z yÃ¼klenmedi, tekrar deneniyor...');
        setTimeout(initZoho, 1000);
        return;
      }
      
      console.log('âœ… ZOHO yÃ¼klendi, baÅŸlatÄ±lÄ±yor...');
      
      try {
        ZOHO.embeddedApp.on("PageLoad", function(data) {
      console.log("Zoho PageLoad:", data);
      
      if (data && data.Entity && data.EntityId) {
        // Zoho CRM'den mÃ¼ÅŸteri bilgilerini al
        ZOHO.CRM.API.getRecord({
          Entity: data.Entity,
          RecordID: data.EntityId
        }).then(function(res) {
          console.log("Zoho CRM Data:", res);
          
          if (res && res.data && res.data.length > 0) {
            var r = res.data[0];
            var name = (r.First_Name || "") + " " + (r.Last_Name || "") || r.Full_Name || "";
            var phone = r.Phone || r.Mobile || "";
            var email = r.Email || "";
            
            console.log("Customer Info:", { name, phone, email, id: r.Id });
            
            // SleekFlow Widget'a mÃ¼ÅŸteri bilgilerini gÃ¶nder
            // Widget yÃ¼klendikten sonra (5 saniye bekleyerek)
            setTimeout(function() {
              if (window.SleekFlowWidget) {
                try {
                  window.SleekFlowWidget.setCustomer({
                    name: name.trim(),
                    email: email,
                    phone: phone,
                    external_id: r.Id
                  });
                  console.log("âœ… MÃ¼ÅŸteri bilgileri SleekFlow widget'a gÃ¶nderildi");
                } catch (e) {
                  console.error("âŒ Widget'a mÃ¼ÅŸteri bilgisi gÃ¶nderilemedi:", e);
                }
              } else {
                console.warn("âš ï¸ SleekFlow Widget henÃ¼z yÃ¼klenmedi, tekrar deneniyor...");
                // Widget yÃ¼klenene kadar tekrar dene
                var retries = 0;
                var interval = setInterval(function() {
                  retries++;
                  if (window.SleekFlowWidget) {
                    clearInterval(interval);
                    try {
                      window.SleekFlowWidget.setCustomer({
                        name: name.trim(),
                        email: email,
                        phone: phone,
                        external_id: r.Id
                      });
                      console.log("âœ… MÃ¼ÅŸteri bilgileri SleekFlow widget'a gÃ¶nderildi (retry)");
                    } catch (e) {
                      console.error("âŒ Widget'a mÃ¼ÅŸteri bilgisi gÃ¶nderilemedi:", e);
                    }
                  } else if (retries > 10) {
                    clearInterval(interval);
                    console.error("âŒ SleekFlow Widget yÃ¼klenemedi");
                  }
                }, 1000);
              }
            }, 3000);
          }
        }).catch(function(error) {
          console.error("Zoho CRM API Error:", error);
        });
      } else {
        console.log("Zoho Entity veya EntityId bulunamadÄ±");
      }
    });

        // Zoho Embedded App'i baÅŸlat
        ZOHO.embeddedApp.init();
        console.log("âœ… Zoho Embedded App baÅŸlatÄ±ldÄ±");
      } catch (error) {
        console.error("âŒ Zoho baÅŸlatma hatasÄ±:", error);
      }
    }
    
    // Zoho'yu baÅŸlat (yÃ¼klendikten sonra)
    window.addEventListener('load', function() {
      setTimeout(initZoho, 1000); // 1 saniye bekle, sonra baÅŸlat
    });
    
    console.log("SleekFlow Widget sayfasÄ± yÃ¼klendi");
  </script>
</body>
</html>

